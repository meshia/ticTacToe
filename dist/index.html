<!doctype html>

<html>
<head>
    <meta charset="utf-8">

    <title>Contacts</title>
    <link rel="stylesheet" href="css/main.css?v=$BUILD_VERSiON$">
    <script src='https://code.jquery.com/jquery-1.12.4.min.js'></script>

</head>
    <body>
        <div id="game">
          </div>
        <script>
        const $ = window.$;

        $(function() {
            let newGame = new Game;
            newGame.initGame(6, 4, 'player2', $('#game'));
        });

    class Game {
    constructor(){
        this.cellsAmountPerRow = 6; // default
        this.cellsToWin = 4; // defalult
        this.currentPlayer = 'player1'; // default
        this.gameElement;
    }

    initGame (m, n, playerToStart, gameElement) {
        console.log('this', this, 'gameElement', gameElement);
        if(gameElement && gameElement.length != 0) {
            this.cellsAmountPerRow = (m ? m : this.cellsAmountPerRow);
            this.cellsToWin = (n ? n : this.cellsToWin);
            this.currentPlayer = (playerToStart ? playerToStart : this.currentPlayer);
            this.gameElement = gameElement;
            this.startGamePopup();
            this.initUi();
            this.initCells();
            this.initBackground(this.gameElement);
        }
    }

    startGamePopup() {
        // TODO: start game popup
        // 1. m input
        // 2. n input
        // 3. start button
        // add check - m > n, in not ERROR
    }

    initUi () {
        $('<div/>', {
            "id": 'game-ui',
            "class": 'game-ui'
        }).appendTo(this.gameElement); // add ui div
        this.initPlayer();
    }

    initPlayer() {
        // TODO: create visualization on both players and their marks
        $('<span/>', {
            "id": 'game-player',
            "class": 'game-player',
            "text": "Turn: " + this.currentPlayer
        }).appendTo('#game-ui');
    }

    initCells () {
        // TODO: create cells
        // TODO: create click events for each cells
        // TODO: create checkWin
        // TODO: switch players on click
    }

    initBackground (gameElement) {
        let currentThis = this;
        $('<div/>', {
            "id": 'game-background',
            "class": 'game-background'
        }).appendTo(gameElement); // add background div
        const el = document.querySelector("#game-background");
        el.addEventListener("mousemove", (e) => {
            if(currentThis.gameFinished === false) {
                el.style.backgroundPositionX = (e.offsetX + 600) + "px";
            }
        });
    };

    initRestartButton () {
        let currentThis = this;
        $('<span/>', {
            "id": 'game-restart',
            "class": 'game-restart',
            "text": "Restart?"
        }).appendTo(this.gameElement); // add background div
        $("#game-restart").on("click", function(){
            // TODO: add reset
            $('#game-winners').remove();
            $("#game-restart").off();
            $("#game-restart").remove();
        });
    }
    
}
        </script>
    </body>
</html>