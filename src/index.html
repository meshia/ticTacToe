<!doctype html>

<html>
<head>
    <meta charset="utf-8">

    <title>Contacts</title>
    <link rel="stylesheet" href="css/main.css?v=$BUILD_VERSiON$">
    <script src='https://code.jquery.com/jquery-1.12.4.min.js'></script>

</head>
    <body>
        <div id="game">
          </div>
        <script>
        const $ = window.$;

        $(function() {
            let newGame = new Game;
            newGame.initGame($('#game'));
        });

    class Game {
    constructor(){
        this.cellsAmountPerRow = 6; // default
        this.cellsToWin = 4; // defalult
        this.currentPlayer = 'player1'; // default
        this.gameElement;
    }

    initGame (gameElement) {
        if(gameElement && gameElement.length != 0) {
            this.gameElement = gameElement;
            this.startGamePopup();
            this.initBackground(this.gameElement);
        }
    }

    startGamePopup() {
        // TODO: start game popup
        // add check - m > n, in not ERROR
        $('<div/>', {
            "id": 'game-popup',
            "class": 'game-ui game-popup'
        }).appendTo(this.gameElement); // add popup div

        const $gamepopup = $('#game-popup');

        $('<h2/>', {
            "id": 'game-popup-title',
            "text": 'Set the Game up:'
        }).appendTo($gamepopup); // add to game popup

        $('<label/>', {
            "id": 'game-input-m-label',
            "for": 'game-input-m',
            "text": 'Cells Per Row:'
        }).appendTo($gamepopup); // add to game popup
        $('<input/>', {
            "id": 'game-input-m',
            "class": 'game-input',
            "value": '6'
        }).appendTo($gamepopup); // add to game popup

        $('<label/>', {
            "id": 'game-input-n-label',
            "for": 'game-input-n',
            "text": 'Amout of Cells for the Win:'
        }).appendTo($gamepopup); // add to game popup
        $('<input/>', {
            "id": 'game-input-n',
            "class": 'game-input',
            "value": '4'
        }).appendTo($gamepopup); // add to game popup

        // TODO: register players

        $('<button/>', {
            "id": 'game-popup-start',
            "text": 'START!'
        }).appendTo($gamepopup); // add to game popup

        const $startBtn = $('#game-popup-start');
        const currentThis = this; // so we'll be able to find the 'this' from the listener
        $startBtn.on('click', function() {
            const m = parseInt($('#game-input-m').val());
            const n = parseInt($('#game-input-n').val());
            if(typeof m == 'number' && typeof n == 'number'&& m > n) {
                currentThis.cellsAmountPerRow = (m ? m : currentThis.cellsAmountPerRow);
                currentThis.cellsToWin = (n ? n : currentThis.cellsToWin);
                currentThis.currentPlayer = currentThis.currentPlayer; // TODO:rendom?
                currentThis.initUi();
                currentThis.initCells();
                $startBtn.off();
                $gamepopup.remove();
            } else {
                if(!$('#game-popup-error') || $('#game-popup-error').length === 0) {
                    $('<span/>', {
                        "id": 'game-popup-error',
                        "class": 'game-popup-error',
                        "text": 'please make sure all the inputs are filled with valid numbers only'
                    }).appendTo($gamepopup); // add to game popup
                }
            }
        });
        
    }

    initUi () {
        $('<div/>', {
            "id": 'game-ui',
            "class": 'game-ui'
        }).appendTo(this.gameElement); // add ui div
        this.initPlayer();
    }

    initPlayer() {
        // TODO: create visualization on both players and their marks
        $('<span/>', {
            "id": 'game-player',
            "class": 'game-player',
            "text": "Turn: " + this.currentPlayer
        }).appendTo('#game-ui');
    }

    initCells () {
        // TODO: create cells
        // TODO: create click events for each cells
        // TODO: create checkWin
        // TODO: switch players on click
    }

    initBackground (gameElement) {
        let currentThis = this;
        $('<div/>', {
            "id": 'game-background',
            "class": 'game-background'
        }).appendTo(gameElement); // add background div
        const el = document.querySelector("#game-background");
        el.addEventListener("mousemove", (e) => { //TODO:fix
            if(currentThis.gameFinished === false) {
                el.style.backgroundPositionX = (e.offsetX + 600) + "px";
            }
        });
    };

    initRestartButton () {
        let currentThis = this;
        $('<span/>', {
            "id": 'game-restart',
            "class": 'game-restart',
            "text": "Restart?"
        }).appendTo(this.gameElement); // add background div
        $("#game-restart").on("click", function(){
            // TODO: add reset
            $('#game-winners').remove();
            $("#game-restart").off();
            $("#game-restart").remove();
        });
    }
    
}
        </script>
    </body>
</html>